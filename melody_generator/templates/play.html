<!doctype html>
<!--
  Playback page for Melody Generator
  ----------------------------------
  Renders the preview audio player and provides a direct download link for the
  generated MIDI file. The template expects ``audio`` (base64 WAV data, may be
  empty) and ``midi`` (base64 MIDI data) in the context along with any flashed
  status messages. The latest revision introduces a summary panel fed by the
  ``summary_sections`` context variable so listeners can review the key
  settings—tempo, instrumentation, harmony toggles and ML options—without
  returning to the form.
-->
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Melody Generated</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="app-body">
  <div class="app-container">
    <header class="page-header">
      <h1 class="page-title">Your Melody</h1>
      <p class="page-subtitle">Preview the arrangement or download the MIDI file for use in your DAW.</p>
    </header>

    {% with messages = get_flashed_messages() %}
      {% if messages %}
        <ul class="flash-list" role="alert">
        {% for msg in messages %}
          <li class="flash-item">{{ msg }}</li>
        {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}

    {% if audio %}
      <div class="audio-preview">
        <audio controls autoplay class="audio-player">
          <source src="data:audio/wav;base64,{{ audio }}" type="audio/wav">
          Your browser does not support the audio tag.
        </audio>
      </div>
    {% endif %}

    <div class="playback-actions">
      <a class="primary-button" download="melody.mid" href="data:audio/midi;base64,{{ midi }}">Download MIDI</a>
      <a class="secondary-link" href="/">Generate another melody</a>
    </div>

    <section class="summary-section">
      <h2 class="summary-heading">Session Summary</h2>
      <p class="summary-description">
        Review the parameters used to create this preview before exporting or tweaking another variation.
      </p>
      <div class="summary-grid">
        {% for section in summary_sections %}
          <article class="summary-card">
            <h3 class="summary-title">{{ section.title }}</h3>
            <dl class="summary-list">
              {% for item in section.entries %}
                <div class="summary-item">
                  <dt class="summary-term">{{ item.label }}</dt>
                  <dd class="summary-value">{{ item.value }}</dd>
                </div>
              {% endfor %}
            </dl>
          </article>
        {% endfor %}
      </div>
    </section>
  </div>
</body>
</html>
